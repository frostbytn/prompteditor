<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prompt Template Studio</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-900 text-white h-full flex items-center justify-center p-4">
  <div x-data="promptStudio()" class="w-full max-w-3xl bg-gray-800 rounded-lg shadow-lg p-6 space-y-6">
    <h1 class="text-2xl font-bold text-center">Prompt Template Studio</h1>

    <!-- Template Input -->
    <div>
      <h2 class="font-semibold mb-2">Prompt Template</h2>
      <textarea x-model="template" @input="updateVars" rows="5" class="w-full p-2 bg-gray-900 rounded focus:outline-none"></textarea>
    </div>

    <!-- Test Values -->
    <div>
      <h2 class="font-semibold mb-2">Test Values</h2>
      <template x-for="(val, name) in vars" :key="name">
        <div class="flex items-center mb-2 space-x-2">
          <label class="w-24 text-gray-400" x-text="name"></label>
          <input type="text" x-model="vars[name]" class="flex-1 p-1 bg-gray-900 rounded focus:outline-none">
        </div>
      </template>
    </div>

    <!-- Live Render Output -->
    <div>
      <h2 class="font-semibold mb-2">Live Render</h2>
      <div class="bg-gray-900 rounded p-3 min-h-[4rem]">
        <pre class="whitespace-pre-wrap" x-text="rendered()"></pre>
      </div>
    </div>

    <!-- Output Modes -->
    <div>
      <h2 class="font-semibold mb-2">Output Preview</h2>
      <div class="flex space-x-2 mb-2">
        <button @click="activeTab='plain'" :class="tabClass('plain')">Plain</button>
        <button @click="activeTab='python'" :class="tabClass('python')">Python</button>
        <button @click="activeTab='json'" :class="tabClass('json')">JSON</button>
      </div>
      <div class="bg-gray-900 rounded p-3">
        <pre class="whitespace-pre-wrap" x-show="activeTab==='plain'" x-text="rendered()"></pre>
        <pre class="whitespace-pre-wrap" x-show="activeTab==='python'" x-text="pythonString()"></pre>
        <pre class="whitespace-pre-wrap" x-show="activeTab==='json'" x-text="jsonString()"></pre>
      </div>
    </div>
  </div>

  <script>
  function parseVars(t){
    const re=/{{\s*(\w+)\s*}}|{\s*(\w+)\s*}|\$(\w+)/g;
    const vars=new Set();
    let m;
    while((m=re.exec(t))){
      vars.add(m[1]||m[2]||m[3]);
    }
    return Array.from(vars);
  }
  function promptStudio(){
    return {
      template:'You are chatting with {{user}} about {{topic}}.',
      vars:{user:'Adrian',topic:'AI'},
      activeTab:'plain',
      init(){this.updateVars();},
      updateVars(){
        const names=parseVars(this.template);
        const current={...this.vars};
        this.vars={};
        names.forEach(n=>{this.vars[n]=current[n]||''});
      },
      rendered(){
        let out=this.template;
        for(const [k,v] of Object.entries(this.vars)){
          const re=new RegExp(`{{\\s*${k}\\s*}}|{\\s*${k}\\s*}|\\$${k}`,'g');
          out=out.replace(re,v);
        }
        return out;
      },
      pythonString(){return JSON.stringify(this.rendered());},
      jsonString(){return JSON.stringify(this.rendered());},
      tabClass(t){
        return this.activeTab===t?'px-3 py-1 bg-blue-600 rounded':'px-3 py-1 bg-gray-700 rounded';
      }
    }
  }
  </script>
</body>
</html>
